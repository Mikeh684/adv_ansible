# Jenkins basics

# Install Jenkins on an Azure Linux VM

This article shows how to install [Jenkins](https://jenkins.io) on an Ubuntu Linux VM with the tools and plug-ins configured to work with Azure.

In this article, you'll learn how to:


* Create a setup file that downloads and installs Jenkins
* Create a resource group
* Create a virtual machine with the setup file
* Open port 8080 in order to access Jenkins on the virtual machine
* Connect to the virtual machine via SSH
* Configure a sample Jenkins job based on a sample Java app in GitHub
* Build the sample Jenkins job

## 1. Login to Azure Portal
Log into the [Azure Portal](https://portal.azure.com) using credentials provided by instructor.

## 2. Open Cloud Shell
1. If you already have a Cloud Shell session open, you can skip to the next section.
2. Open Cloud Shell.
![](index/portal-cloud-shell%202.png)

3. If you haven't previously used Cloud Shell, configure the environment and storage settings.
4. Select `Bash`

![](index/choose-cloudshell-cli%202.png)

## 3. Create a virtual machine
* Create a test directory called `jenkins-get-started`.
* Switch to the test directory.
* Create a file named `cloud-init-jenkins.txt`.

Paste the following code into the new file:

```
#cloud-config
package_upgrade: true
runcmd:
  - sudo apt install openjdk-8-jdk -y
  - wget -qO - https://pkg.jenkins.io/debian-stable/jenkins.io.key | sudo apt-key add -
  - sh -c 'echo deb https://pkg.jenkins.io/debian-stable binary/ > /etc/apt/sources.list.d/jenkins.list'
  - sudo apt-get update && sudo apt-get install jenkins -y
  - sudo service jenkins restart
```


Run `az group create` to create a resource group.

```azurecli
az group create --name jenkins-get-started-rg --location eastus
```

Run  `az vm create` to create a virtual machine.

```azurecli
az vm create \
--resource-group jenkins-get-started-rg \
--name jenkins-get-started-vm \
--image UbuntuLTS \
--admin-username "azureuser" \
--generate-ssh-keys \
--public-ip-sku Standard \
--custom-data cloud-init-jenkins.txt
```

Run `az vm list` to verify the creation (and state) of the new virtual machine.

```azurecli
az vm list -d -o table --query "[?name=='jenkins-get-started-vm']"    
```

As Jenkins runs on port 8080, run `az vm open` to open port 8080 on the new virtual machine.

```azurecli
az vm open-port \
--resource-group jenkins-get-started-rg \
--name jenkins-get-started-vm  \
--port 8080 --priority 1010    
```

## 4. Configure Jenkins

Run `az vm show` to get the public IP address for the sample virtual machine.

```azurecli
az vm show \
--resource-group jenkins-get-started-rg \
--name jenkins-get-started-vm -d \
--query [publicIps] \
--output tsv
```

**Key points**:

- The `--query` parameter limits the output to the public IP addresses for the virtual machine.

Using the IP address retrieved in the previous step, SSH into the virtual machine. You'll need to confirm the connection request.

```azurecli
ssh azureuser@<ip_address>
```


Verify that Jenkins is running by getting the status of the Jenkins service.

```bash
service jenkins status
```

**Key points**:

- If you receive an error regarding the service not existing, you may have to wait a couple of minutes for everything to install and initialize.

Get the autogenerated Jenkins password.

```bash
sudo cat /var/lib/jenkins/secrets/initialAdminPassword
```

Using the IP address, open the following URL in a browser: `http://<ip_address>:8080`

Enter the password you retrieved earlier and select **Continue**.
![](index/unlock-jenkins%202.png)

Select **Select plug-in to install**.

![](index/select-plugins%202.png)

In the filter box at the top of the page, enter `github`. Select the GitHub plug-in and select **Install**.

    ![](index/install-github-plugin.png)

Enter the information for the first admin user and select **Save and Continue**.

![](index/create-first-user%202.png)

On the **Instance Configuration** page, select **Save and Finish**.

![](index/instance-configuration%202.png)

Select **Start using Jenkins**.
  ![](index/start-using-jenkins%202.png)

## 5. Create your first job

On the Jenkins home page, select **Create a job**.

![](index/CD434BF6-2C19-4F4A-AEFE-C7592362AE14%202.png)

Enter a job name of `mySampleApp`, select **Freestyle project**, and select **OK**.
 ![](index/new-job%202.png)

Select the **Source Code Management** tab. Enable **Git** and enter the following URL for the **Repository URL** value: `https://github.com/spring-guides/gs-spring-boot.git`. Then change the **Branch Specifier** to `*/main`.

![](index/source-code-management%202.png)

Select the **Build** tab, then select **Add build step**

![](index/add-build-step%202.png)

From the drop-down menu, select **Invoke Gradle script**.

![](index/invoke-gradle-script-option%202.png)

Select **Use Gradle Wrapper**, then enter `complete` in **Wrapper location** and `build` for **Tasks**.

![](index/gradle-script-options%202.png)

Select **Advanced** and enter `complete` in the **Root Build script** field.

![](index/root-build-script%202.png)

Scroll to the bottom of the page, and select **Save**.

## 6. Build the sample Java app

When the home page for your project displays, select **Build Now** to compile the code and package the sample app.

![](index/project-home-page%202.png)

A graphic below the **Build History** heading indicates that the job is being built.

  ![](index/job-currently-building%202.png)

When the build completes, select the **Workspace** link.

![](index/job-workspace%202.png)

Navigate to `complete/build/libs` to see that the `.jar` file was successfully built.

 ![](index/successful-build%202.png)

You can also confirm the build was successful by viewing the console output. 

* Click the icon on the left of the build job ID
	
![](index/jenkins-console%202.jpg)

* The console output will show if the build was successful. 
	
![](index/console-success%202.jpg)


Your Jenkins server is now ready to build your own projects in Azure!

## Congrats!
